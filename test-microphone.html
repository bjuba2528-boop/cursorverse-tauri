<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –ú–∏–∫—Ä–æ—Ñ–æ–Ω–∞</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .test-block {
            background: #2a2a2a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            border: 2px solid #dc143c;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            font-size: 16px;
            cursor: pointer;
            background: linear-gradient(135deg, #dc143c, #8b0000);
            color: white;
            border: none;
            border-radius: 8px;
            transition: all 0.3s;
        }
        button:hover {
            transform: scale(1.05);
        }
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .success { background: rgba(34, 197, 94, 0.2); border: 1px solid #22c55e; }
        .error { background: rgba(239, 68, 68, 0.2); border: 1px solid #ef4444; }
        .info { background: rgba(59, 130, 246, 0.2); border: 1px solid #3b82f6; }
        #log {
            background: #000;
            padding: 15px;
            border-radius: 5px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }
        .log-entry {
            margin: 3px 0;
            padding: 3px;
        }
        canvas {
            width: 100%;
            height: 100px;
            background: #000;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>üé§ –¢–µ—Å—Ç –ú–∏–∫—Ä–æ—Ñ–æ–Ω–∞ CursorVerse</h1>
    <p>–≠—Ç–æ—Ç —Ñ–∞–π–ª –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞–±–æ—Ç—É –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ –∏ Web APIs</p>

    <div class="test-block">
        <h2>1Ô∏è‚É£ –¢–µ—Å—Ç MediaDevices API</h2>
        <button onclick="testMediaDevices()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å API</button>
        <div id="mediaStatus"></div>
    </div>

    <div class="test-block">
        <h2>2Ô∏è‚É£ –¢–µ—Å—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É</h2>
        <button onclick="testMicrophone()">–ó–∞–ø—Ä–æ—Å–∏—Ç—å –¥–æ—Å—Ç—É–ø</button>
        <div id="micStatus"></div>
    </div>

    <div class="test-block">
        <h2>3Ô∏è‚É£ –¢–µ—Å—Ç Speech Recognition API</h2>
        <button onclick="testSpeechRecognition()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ</button>
        <button onclick="startRecognition()" id="startBtn" disabled>–ù–∞—á–∞—Ç—å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ</button>
        <button onclick="stopRecognition()" id="stopBtn" disabled>–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
        <div id="speechStatus"></div>
        <div id="transcript" style="margin-top:10px; padding:10px; background:#000; border-radius:5px;"></div>
    </div>

    <div class="test-block">
        <h2>4Ô∏è‚É£ –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∑–≤—É–∫–∞ (–î–µ—Ç–µ–∫—Ç–æ—Ä —Ö–ª–æ–ø–∫–æ–≤)</h2>
        <button onclick="startClapDetection()">–ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–µ—Ç–µ–∫—Ç–æ—Ä</button>
        <button onclick="stopClapDetection()">–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
        <canvas id="visualizer"></canvas>
        <div id="clapStatus"></div>
    </div>

    <div class="test-block">
        <h2>üìã –õ–æ–≥ —Å–æ–±—ã—Ç–∏–π</h2>
        <button onclick="clearLog()">–û—á–∏—Å—Ç–∏—Ç—å</button>
        <div id="log"></div>
    </div>

    <script>
        let recognition = null;
        let audioContext = null;
        let analyser = null;
        let animationId = null;

        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            const timestamp = new Date().toLocaleTimeString();
            entry.innerHTML = `[${timestamp}] ${message}`;
            
            if (type === 'error') entry.style.color = '#ef4444';
            else if (type === 'success') entry.style.color = '#22c55e';
            else if (type === 'warn') entry.style.color = '#f59e0b';
            
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        function testMediaDevices() {
            log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ MediaDevices API...');
            const status = document.getElementById('mediaStatus');
            
            if (!navigator.mediaDevices) {
                status.className = 'status error';
                status.textContent = '‚ùå MediaDevices API –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è';
                log('‚ùå MediaDevices API –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
                return;
            }
            
            if (!navigator.mediaDevices.getUserMedia) {
                status.className = 'status error';
                status.textContent = '‚ùå getUserMedia –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è';
                log('‚ùå getUserMedia –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
                return;
            }
            
            status.className = 'status success';
            status.textContent = '‚úÖ MediaDevices API –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è';
            log('‚úÖ MediaDevices API –¥–æ—Å—Ç—É–ø–µ–Ω', 'success');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
            navigator.mediaDevices.enumerateDevices()
                .then(devices => {
                    const mics = devices.filter(d => d.kind === 'audioinput');
                    log(`üì± –ù–∞–π–¥–µ–Ω–æ –º–∏–∫—Ä–æ—Ñ–æ–Ω–æ–≤: ${mics.length}`, 'success');
                    mics.forEach((mic, i) => {
                        log(`  ${i + 1}. ${mic.label || '–ë–µ–∑—ã–º—è–Ω–Ω—ã–π –º–∏–∫—Ä–æ—Ñ–æ–Ω'}`);
                    });
                })
                .catch(err => {
                    log(`‚ùå –û—à–∏–±–∫–∞ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤: ${err.message}`, 'error');
                });
        }

        async function testMicrophone() {
            log('üìã –ó–∞–ø—Ä–æ—Å –¥–æ—Å—Ç—É–ø–∞ –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É...');
            const status = document.getElementById('micStatus');
            
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                status.className = 'status success';
                status.textContent = '‚úÖ –î–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É –ø–æ–ª—É—á–µ–Ω';
                log('‚úÖ –î–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É —Ä–∞–∑—Ä–µ—à–µ–Ω', 'success');
                
                // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç—Ä–µ–∫–µ
                const track = stream.getAudioTracks()[0];
                const settings = track.getSettings();
                log(`üé§ –ù–∞—Å—Ç—Ä–æ–π–∫–∏: ${JSON.stringify(settings)}`);
                
                // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç—Ä–∏–º
                stream.getTracks().forEach(track => track.stop());
                log('üõë –°—Ç—Ä–∏–º –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
                
            } catch (error) {
                status.className = 'status error';
                status.textContent = `‚ùå –û—à–∏–±–∫–∞: ${error.name}`;
                log(`‚ùå –û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞: ${error.name} - ${error.message}`, 'error');
                
                if (error.name === 'NotAllowedError') {
                    log('üîí –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º', 'warn');
                } else if (error.name === 'NotFoundError') {
                    log('üé§ –ú–∏–∫—Ä–æ—Ñ–æ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω', 'warn');
                }
            }
        }

        function testSpeechRecognition() {
            log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ Speech Recognition API...');
            const status = document.getElementById('speechStatus');
            
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            
            if (!SpeechRecognition) {
                status.className = 'status error';
                status.textContent = '‚ùå Speech Recognition –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è';
                log('‚ùå Speech Recognition API –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
                log('üí° –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Chrome, Edge –∏–ª–∏ Chromium-–±—Ä–∞—É–∑–µ—Ä', 'warn');
                return;
            }
            
            status.className = 'status success';
            status.textContent = '‚úÖ Speech Recognition –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è';
            log('‚úÖ Speech Recognition API –¥–æ—Å—Ç—É–ø–µ–Ω', 'success');
            
            document.getElementById('startBtn').disabled = false;
        }

        function startRecognition() {
            log('üé§ –ó–∞–ø—É—Å–∫ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä–µ—á–∏...');
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            
            recognition = new SpeechRecognition();
            recognition.lang = 'ru-RU';
            recognition.continuous = false;
            recognition.interimResults = true;
            
            recognition.onstart = () => {
                log('‚úÖ –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ', 'success');
                document.getElementById('startBtn').disabled = true;
                document.getElementById('stopBtn').disabled = false;
                document.getElementById('transcript').innerHTML = '<em>–°–ª—É—à–∞—é...</em>';
            };
            
            recognition.onresult = (event) => {
                const transcript = Array.from(event.results)
                    .map(result => result[0].transcript)
                    .join('');
                
                document.getElementById('transcript').textContent = transcript;
                log(`üó£Ô∏è –†–∞—Å–ø–æ–∑–Ω–∞–Ω–æ: ${transcript}`);
            };
            
            recognition.onerror = (event) => {
                log(`‚ùå –û—à–∏–±–∫–∞: ${event.error}`, 'error');
            };
            
            recognition.onend = () => {
                log('üõë –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ');
                document.getElementById('startBtn').disabled = false;
                document.getElementById('stopBtn').disabled = true;
            };
            
            recognition.start();
        }

        function stopRecognition() {
            if (recognition) {
                recognition.stop();
                log('üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è...');
            }
        }

        async function startClapDetection() {
            log('üëè –ó–∞–ø—É—Å–∫ –¥–µ—Ç–µ–∫—Ç–æ—Ä–∞ —Ö–ª–æ–ø–∫–æ–≤...');
            const status = document.getElementById('clapStatus');
            const canvas = document.getElementById('visualizer');
            const ctx = canvas.getContext('2d');
            
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                analyser = audioContext.createAnalyser();
                const microphone = audioContext.createMediaStreamSource(stream);
                
                analyser.fftSize = 512;
                analyser.smoothingTimeConstant = 0.3;
                microphone.connect(analyser);
                
                status.className = 'status success';
                status.textContent = '‚úÖ –î–µ—Ç–µ–∫—Ç–æ—Ä –∞–∫—Ç–∏–≤–µ–Ω. –•–ª–æ–ø–Ω–∏—Ç–µ 2 —Ä–∞–∑–∞!';
                log('‚úÖ –î–µ—Ç–µ–∫—Ç–æ—Ä —Ö–ª–æ–ø–∫–æ–≤ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω', 'success');
                
                const dataArray = new Uint8Array(analyser.frequencyBinCount);
                let lastClapTime = 0;
                let clapCount = 0;
                
                function draw() {
                    if (!analyser) return;
                    
                    animationId = requestAnimationFrame(draw);
                    
                    analyser.getByteFrequencyData(dataArray);
                    
                    // –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
                    ctx.fillStyle = '#000';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    
                    const barWidth = canvas.width / dataArray.length;
                    let x = 0;
                    
                    for (let i = 0; i < dataArray.length; i++) {
                        const barHeight = (dataArray[i] / 255) * canvas.height;
                        ctx.fillStyle = `hsl(${(dataArray[i] / 255) * 360}, 100%, 50%)`;
                        ctx.fillRect(x, canvas.height - barHeight, barWidth, barHeight);
                        x += barWidth;
                    }
                    
                    // –î–µ—Ç–µ–∫—Ü–∏—è —Ö–ª–æ–ø–∫–æ–≤
                    const average = dataArray.reduce((a, b) => a + b) / dataArray.length;
                    
                    if (average > 180) {
                        const now = Date.now();
                        const timeSince = now - lastClapTime;
                        
                        if (timeSince < 700 && timeSince > 100) {
                            clapCount++;
                            log(`üëè –•–ª–æ–ø–æ–∫ ${clapCount}`);
                            
                            if (clapCount === 2) {
                                log('‚ú® –î–í–û–ô–ù–û–ô –•–õ–û–ü–û–ö –û–ë–ù–ê–†–£–ñ–ï–ù!', 'success');
                                status.textContent = '‚ú® –î–≤–æ–π–Ω–æ–π —Ö–ª–æ–ø–æ–∫ –æ–±–Ω–∞—Ä—É–∂–µ–Ω!';
                                clapCount = 0;
                            }
                        } else if (timeSince >= 700) {
                            clapCount = 1;
                            log('üëè –•–ª–æ–ø–æ–∫ 1');
                        }
                        
                        lastClapTime = now;
                    }
                }
                
                draw();
                
            } catch (error) {
                status.className = 'status error';
                status.textContent = `‚ùå –û—à–∏–±–∫–∞: ${error.name}`;
                log(`‚ùå –û—à–∏–±–∫–∞ –¥–µ—Ç–µ–∫—Ç–æ—Ä–∞: ${error.message}`, 'error');
            }
        }

        function stopClapDetection() {
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
            if (audioContext) {
                audioContext.close();
                audioContext = null;
                analyser = null;
            }
            document.getElementById('clapStatus').textContent = 'üõë –î–µ—Ç–µ–∫—Ç–æ—Ä –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω';
            log('üõë –î–µ—Ç–µ–∫—Ç–æ—Ä —Ö–ª–æ–ø–∫–æ–≤ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        log('üöÄ –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞', 'success');
        log('üí° –ù–∞–∂–∏–º–∞–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ—É–Ω–∫—Ü–∏–π');
    </script>
</body>
</html>
